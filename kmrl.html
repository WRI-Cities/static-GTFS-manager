<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags-->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<title>GTFS Manager : KRML Import</title>


	<!-- Fontfaces CSS-->
	<link href="css/font-face.css" rel="stylesheet" media="all">
	<link href="vendor/font-awesome-5/css/all.min.css" rel="stylesheet" media="all">

	<!-- Bootstrap CSS-->
	<link href="vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

	<!-- Leaflet Maps -->
	<link href="lib/leaflet.css" orig="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" rel="stylesheet" />
	<link href="lib/easy-button.css" alt="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css"
		rel="stylesheet" />
	<link href="lib/L.Control.ZoomBox.css" rel="stylesheet" />
	<link href="vendor/leaflet-control-geocoder-1.8.2/Control.Geocoder.css" rel="stylesheet" />

	<!-- Vendor CSS-->
	<link href="vendor/wow/animate.css" rel="stylesheet" media="all">
	<link href="vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
	<link href="vendor/slick/slick.css" rel="stylesheet" media="all">
	<link href="vendor/select2/css/select2.min.css" rel="stylesheet" media="all">
	<link href="vendor/select2/css/select2-bootstrap4.min.css" rel="stylesheet" media="all">
	<link href="vendor/toast-0.7.1/toast.min.css" rel="stylesheet" media="all">

	<link href="vendor/tabulator-4.4.0/css/bootstrap/tabulator_bootstrap4.min.css" rel="stylesheet" media="all">
	<script src="vendor/tabulator-4.4.0/js/tabulator.min.js"></script>

	<!-- Main CSS-->
	<link href="css/theme.css" rel="stylesheet" media="all">
	<!-- Put the CSSs first and JSs next -->
	<style>
		#map,
		#stops-table {
			width: 100%;
		}

		#map {
			height: 500px;
		}

		#stops-table {
			height: 400px;
		}

		/* leaflet stop markers */

		.stop-divicon {
			border-radius: 50%;
			color: white;
			padding-top: 1px;
			position: absolute;
			text-align: center;
			overflow: hidden;
			box-shadow: 0px 0px 5px black;
			/*looks 3D! no need of a border*/
			background-color: rgba(0, 0, 150, 0.7);
			font-size: 10px;
			font-weight: 600;
		}
	</style>
</head>

<body>
	<div class="page-wrapper">
		<!-- HEADER DESKTOP-->
		<!-- HEADER DESKTOP-->
		<header class="header-desktop3 d-none d-lg-block">
			<div class="section__content section__content--p35">
				<div class="header3-wrap">
					<div class="header__logo">
						<a href="#">
							<img src="extra_files/GTFS.png" width="52" height="170" alt="GTFS Manager" />
						</a>
					</div>
					<div class="header__navbar" id="navmenuinsert">
						<!-- menu will be inserted from menu.js.-->
					</div>
					<div class="form-inline my-2 my-md-0">
						<input id="password" class="form-control mr-sm-2" type="text" placeholder="pw for edits"
							style="width:200px;" id="password">
					</div>
				</div>
			</div>
		</header>
		<!-- END HEADER DESKTOP-->
		<!-- MAIN CONTENT-->
		<div class="page-content--bgf7">
			<div class="section__content section__content--p30">
				<div class="container">
					<div class="row">
						<div class="col-md-12">
							<div class="accordion" id="accordionExample">
								<div class="card">
									<div class="card-header" id="headingOne">
										<h2 class="mb-0">
											<button class="btn btn-link" type="button" data-toggle="collapse"
												data-target="#collapseOne" aria-expanded="false"
												aria-controls="collapseOne">
												<i class="fas fa-angle-right"></i> Instructions
											</button>
										</h2>
									</div>
									<div id="collapseOne" class="collapse" aria-labelledby="headingOne"
										data-parent="#accordionExample">
										<div class="card-body">
											<p align="center">
												<a href="https://www.youtube.com/embed/_JYVtm-6iJg?rel=0&autoplay=1"
													target="_blank">
													<img class="videothumb"
														src="extra_files/GTFS-manager-XML-import-diagnostic.png"
														height="240" width="auto">
													<br>
													<small>Click here to see a demo video.</small>
												</a>
											</p>
											<p>This page handles the
												<a target="_blank" href="extra_files/sample-XML-structure.txt">specific
													XML format&#x2197;</a> of KMRL. There are some files to upload and
												some settings to set before converting
												to GTFS. Please make your way through each of the tabs.</p>
											- Detailed instructions are given in info boxes at each tab.

										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-12">
							<div class="card">
								<div class="card-header">
									<strong class="card-title mb-3">Convert Kochi Metro's XML schedules format to
										GTFS</strong>
								</div>
								<div class="card-body">
									<ul class="nav nav-tabs" id="myTab" role="tablist">
										<li class="nav-item">
											<a class="nav-link active" id="LoadXML-tab" data-toggle="tab"
												href="#LoadXML" role="tab" aria-controls="LoadXML"
												aria-selected="true">1. Load XMLs</a>
										</li>
										<li class="nav-item">
											<a class="nav-link" id="Stations-tab" data-toggle="tab" href="#Stations"
												role="tab" aria-controls="Stations" aria-selected="false">2.
												Stations</a>
										</li>
										<li class="nav-item">
											<a class="nav-link" id="Misc-tab" data-toggle="tab" href="#Misc" role="tab"
												aria-controls="Misc" aria-selected="false">3. Misc Info</a>
										</li>
										<li class="nav-item">
											<a class="nav-link" id="Finally-tab" data-toggle="tab" href="#Finally"
												role="tab" aria-controls="Finally" aria-selected="false">4. Finally</a>
										</li>
									</ul>
									<div class="tab-content" id="myTabContent">
										<div class="tab-pane fade show active" id="LoadXML" role="tabpanel"
											aria-labelledby="LoadXML-tab">
											<div class="container">
												<div class="row">
													<div class="col-md-4">
														<h4>
															<a id="1"></a>1. Load XMLs</h4>
														<p>Weekdays:
															<input type="file" id="weekdayXML" name="weekdayXML"
																accept="text/xml"
																class="btn btn-sm btn-outline-secondary">
														</p>
														<p>Sundays:
															<input type="file" id="sundayXML" name="sundayXML"
																accept="text/xml"
																class="btn btn-sm btn-outline-secondary">
														</p>
														<p>
															<button id="XMLUploadButton"
																class="btn btn-outline-primary">Upload >></button>
														</p>
														<br>
														<br>
														<p>
															<a target="_blank"
																href="extra_files/sample-XML-structure.txt">Click
																here&#x2197;</a> to see a sample structure of the KMRL
															XML format.</p>
													</div>
													<div class="col-md-8">
														<div class="card mb-3 card-body bg-light" id="XMLUploadStatus">
															<small>Diagnostic
																<br>Choose the files to upload..
																<br> and remember to put in the password on top right.
																<br>
																<br> Note: Be sure about which file is for weekdays and
																which for sunday.. as the files internally have no day
																information on them.
																<br>
																<br> After you click Upload, the system will load the
																XMLs and run a diagnostic check on them. The report of
																the
																diagnostic will be shown in this box.
																<a href="extra_files/GTFS-manager-XML-upload-analsis.png"
																	target="_blank">See screenshot.</a>
															</small>
														</div>
													</div>
												</div>
												<hr>
											</div>
										</div>
										<div class="tab-pane fade" id="Stations" role="tabpanel"
											aria-labelledby="Stations-tab">
											<h4>
												<a id="2"></a>2. Stations</h4>
											<div class="card mb-3 card-body bg-light">
												<div class="row">
													<div class="col-md-6" id="stationsStatus">
														Upload XMLs in step 1...
													</div>
													<div class="col-md-6">
														<p>
															<small>Instructions: If the diagnostic check showed that
																there were Unmapped stops, then edit the stations table
																below
																to update. When done, click "Save Changes" button below.
																That will trigger the diagnostic check once again.
																<br>Note: The map will not update with changes you make
																in the table. Click Save Changes and then it will
																update.</small>
														</p>
													</div>
												</div>
											</div>

											<div class="row">
												<div class="col-md-8">

													<div id="stations-table"></div>

												</div>
												<div class="col-md-4">

													<div id="map"></div>
												</div>
											</div>
											<br>
											<div class="row">
												<div class="col">

													<p>Add a new station:
														<input placeholder="stop_id" id="station2add" size="4">
														<button class="btn-primary" id="addStation"
															type="button">Add</button>
														<small id="stationAddStatus"></small>
													</p>

												</div>
												<div class="col">

													<div class="alert alert-warning">
														<p>
															<b data-toggle="popover" data-trigger="hover"
																data-placement="left" data-html="true"
																title="Depot Station"
																data-content="All trips originating from and terminating at this station will be <u>dropped</u> from the GTFS feed, as depot trips (typically first and last trips in the day for a vehicle) do not carry passengers.<br>The <b>Count</b> of trips being dropped will be shown in the diagnostic.<br><i>Select 'None' if your XML doesn't have any without-passenger trips to be dropped.</i>">
																<big>&#9875;</big>Depot Station</b>:
															<select name="depot" id="depot">
															</select>
														</p>
													</div>

												</div>
												<div class="col">

													<p>
														<button id="saveStationsButton" class="btn btn-success">Save
															Changes to Stations</button>
														<small id="stationsSaveStatus"></small>
													</p>
													<small>If the XMLs are uploaded, diagnostic check will also be run
														again.</small>

												</div>
											</div>


											<p align="center">
												<button id="reDiagnose" class="btn btn-warning">&#10148; Run Diagnostic
													Again</button>
												<small id="reDiagnoseStatus"></small>
											</p>

											<br>
											<hr>
										</div>
										<div class="tab-pane fade" id="Misc" role="tabpanel" aria-labelledby="Misc-tab">
											<h4>
												<a id="3"></a>3. Misc Info</h4>
											<div class="row">
												<div class="col-md-3">

													<h5>Routes Info
														<span id="routes-check"></span>
													</h5>
													<div id="routesInfoPopulate">
														<small>
															<div class="alert alert-secondary">This section will
																auto-populate after the XMLs have been loaded.</div>
														</small>
													</div>

												</div>
												<div class="col-md-3">

													<h5>Agency Info
														<span id="agency-check"></span>
													</h5>
													<p>
														<small>
															<label
																title="Short, unique internal code for agency, like KMRL">id:
																<input required id="agency_id" size="5">
															</label>
															<br>
															<label title="Official name of agency">name:
																<input required id="agency_name" size="10">
															</label>
															<br>
															<label
																title="Local language translation of name of agency">name
																translation:
																<input id="agency_name_translation" size="10">
															</label>
															<br>
															<label title="Official website of agency (agency_url)">url:
																<input required id="agency_url" size="15">
															</label>
															<br>
															<label title="Phone number (agency_phone)">phone:
																<input required id="agency_phone" size="12">
															</label>
															<br>
															<label title="Fare URL (agency_fare_url)">fare url:
																<input required id="agency_fare_url" size="15">
															</label>
															<br>
															<label>agency_timezone:
																<input required id="agency_timezone" size="10">
															</label>
														</small>
													</p>
													<hr>

												</div>
												<div class="col-md-3">

													<h5>Fares
														<span id="fares-check"></span>
													</h5>
													<small>
														<p>Upload Fares Chart CSV: (
															<a target="_blank"
																href="xml_related/fares-chart.csv">sample</a>)
															<input type="file" id="fareChart" name="fareChart"
																accept=".csv" class="btn btn-sm btn-outline-secondary">
															<br>
															<button id="fareChartUploadButton"
																class="btn btn-sm btn-outline-primary">Upload
																>></button>
														</p>
														<div id="fareChartUploadStatus"></div>
														<div id="fareAttrPopulate"></div>
													</small>

												</div>
												<div class="col-md-3">

													<h5>Calendar
														<span id="calendar-check"></span>
													</h5>
													<p>
														<small>
															<label
																title="Date from which the uploaded schedule is in operation, in YYYYMMDD format.">Start
																date:
																<input required id="start_date" size="8"
																	placeholder="YYYYMMDD">
															</label>
															<br>
															<label
																title="Needed as a formality. Tentative last date of operation of uploaded schedule, in YYYYMMDD format. Can put any value till 2099. Can change later.">End
																date:
																<input required id="end_date" size="8"
																	placeholder="YYYYMMDD">
															</label>
														</small>
													</p>


												</div>
											</div>
											<p align="center">
												<button class="btn btn-md btn-warning" id="checkMiscButton">Check and
													Submit</button>
											</p>
											<p align="center" id="checkMiscStatus"></p>
											<br>
											<div class="col-md-6 alert alert-secondary">
												<small>
													Note: The system is internally storing these configurations when you
													press the button 'Check and Submit'. So, if you change
													any of the values after pressing, your newly typed values will NOT
													be processed. Please make sure you press the
													button at the end before proceeding to step 4.
													<br>
													<br>See a
													<a href="extra_files/GTFS-manager-XML-import-diagnostic.png"
														target="_blank">screenshot</a> of how this page would look when
													all data is properly loaded.
												</small>
											</div>

											<br>
											<hr>

										</div>
										<div class="tab-pane fade" id="Finally" role="tabpanel"
											aria-labelledby="Finally-tab">

											<h4>4. Finally</h4>
											<p>
												<button id="xml2GTFSButton" class="btn btn-md" disabled>Start XML to
													GTFS conversion</button>
											</p>
											<p id="xml2GTFSStatus"></p>
											<br>
											<br>
											<div class="alert alert-info col-md-6">
												<small>Note: This import process will be similar to the GTFS import
													process on the home page. The data currently loaded
													will be exported as a backup, and a fresh GTFS feed will be created
													using the data you have uploaded and entered.</small>
											</div>

										</div>
									</div>







								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- END MAIN CONTENT-->
				<!-- END PAGE CONTAINER-->
			</div>

		</div>
	</div>

	<!-- Jquery JS-->
	<script src="vendor/jquery-3.2.1.min.js"></script>
	<!-- Bootstrap JS-->
	<script src="vendor/bootstrap-4.1/popper.min.js"></script>
	<script src="vendor/bootstrap-4.1/bootstrap.min.js"></script>

	<!-- Leaflet Maps -->

	<script src="lib/leaflet.js"></script>
	<script src="lib/easy-button.js"
		alt="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
	<script src="lib/papaparse.min.js" type="text/javascript"></script>
	<script src="lib/L.Control.ZoomBox.min.js" type="text/javascript"></script>
	<script src="vendor/leaflet-control-geocoder-1.8.2/Control.Geocoder.js"></script>

	<!-- Vendor JS       -->
	<script src="vendor/animsition/animsition.min.js"></script>
	<script src="vendor/circle-progress/circle-progress.min.js"></script>
	<script src="vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
	<script src="vendor/chartjs/Chart.bundle.min.js"></script>
	<script src="vendor/select2/js/select2.min.js"></script>
	<script src="js/Select2EditorTimezone.js"></script>
	<script src="vendor/toast-0.7.1/toast.min.js"></script>
	<!-- Main JS-->
	<script src="js/main.js"></script>
	<script src="js/menu.js"></script>

	<script src="config/settings.js" type="text/javascript"></script>
	<script src="js/commonfuncs.js" type="text/javascript"></script>
	<script src="js/xml2GTFS.js"></script>

</body>

</html>