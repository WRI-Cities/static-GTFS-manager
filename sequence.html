<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags-->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<title>GTFS Manager : Default route sequence</title>


	<!-- Fontfaces CSS-->
	<link href="css/font-face.css" rel="stylesheet" media="all">
	<link href="vendor/font-awesome-5/css/all.min.css" rel="stylesheet" media="all">

	<!-- Bootstrap CSS-->
	<link href="vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

	<!-- Leaflet Maps -->
	<link href="lib/leaflet.css" orig="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" rel="stylesheet" />
	<link href="lib/easy-button.css" alt="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css" rel="stylesheet" />
	<link href="lib/L.Control.ZoomBox.css" rel="stylesheet" />
	<link href="vendor/leaflet-control-geocoder-1.8.2/Control.Geocoder.css" rel="stylesheet" />

	<!-- Vendor CSS-->

	<link href="vendor/wow/animate.css" rel="stylesheet" media="all">
	<link href="vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
	<link href="vendor/slick/slick.css" rel="stylesheet" media="all">
	<link href="vendor/select2/css/select2.min.css" rel="stylesheet" media="all">
	<link href="vendor/select2/css/select2-bootstrap4.min.css" rel="stylesheet" media="all">
	<link href="vendor/toast-0.7.1/toast.min.css" rel="stylesheet" media="all">

	<link href="vendor/tabulator-4.4.1/css/bootstrap/tabulator_bootstrap4.min.css" rel="stylesheet" media="all">
	<script src="vendor/tabulator-4.4.1/js/tabulator.min.js"></script>

	<!-- Main CSS-->
	<link href="css/theme.css" rel="stylesheet" media="all">
	<!-- Put the CSSs first and JSs next -->
	<style>
		.map-container {
			height: 100%;
			/* Fallback for vmin */
			padding: 0px 1rem 1rem 1rem;
			padding: 0px 1vmin 1vmin 1vmin;
		}

		.map-frame {
			height: 100%;
			width: 100%;
			/*   We use outline over border as has issues in some cases */
			outline: 1px solid black;
		}

		#map0,
		#map1 {
			height: 100%;
			z-index: 0;
		}

		/* #map0, #map1 {
			height: 400px;
			z-index: 0;
		} */

		#sequence-0-table,
		#sequence-1-table {
			height: 350px;
		}

		#routes-table {
			height: 400px;
		}

		input[type=checkbox]#reverseCheck {
			width: 20px;
			height: 20px;
			-webkit-border-radius: 22px;
			-moz-border-radius: 22px;
			border-radius: 22px;
			border: 1px solid #bbb;
			vertical-align: middle;
		}


		/* Leaflet Map Overlay */
		.overlaycontainer {
			position: relative;
			width: 100%;
			height: 400px;
		}

		/* #map0 {
			position:absolute;
			width: 100%;
		} */
		.shapeOverlay {
			position: absolute;
			background-color: rgba(255, 255, 255, .5);
			height: auto;
			width: 150px;
			top: 10px;
			right: 10px;
			border-radius: 5px;
			padding: 5px;
			box-shadow: 0px 0px 20px black;
		}


		/* for map, custom markers */

		.sequence-0-divicon,
		.sequence-1-divicon {
			border-radius: 50%;
			color: white;
			padding-top: 2px;
			position: absolute;
			text-align: center;
			overflow: hidden;
			box-shadow: 0px 0px 10px black;
			/*looks 3D! no need of a border*/
		}

		.sequence-0-divicon {
			background-color: rgba(0, 0, 255, 0.7);
		}

		.sequence-1-divicon {
			background-color: rgba(128, 0, 128, 0.7);
		}
	</style>
</head>

<body class="">
	<div class="page-wrapper">
		<!-- HEADER DESKTOP-->
		<header class="header-desktop3 d-none d-lg-block">
			<div class="section__content section__content--p35">
				<div class="header3-wrap">
					<div class="header__logo">
						<a href="#">
							<img src="extra_files/GTFS.png" width="52" height="170" alt="GTFS Manager" />
						</a>
					</div>
					<div class="header__navbar" id="navmenuinsert">
						<!-- menu will be inserted from menu.js.-->
					</div>
					<div class="form-inline my-2 my-md-0">
						<input id="password" class="form-control mr-sm-2" type="text" placeholder="pw for edits" style="width:200px;" id="password">
					</div>
				</div>
			</div>
		</header>
		<!-- END HEADER DESKTOP-->
		<!-- MAIN CONTENT-->
		<div class="page-content--bgf7">
			<div class="section__content section__content--p30">
				<div class="container">
					<div class="row">
						<div class="col-md-12">
							<div class="accordion" id="accordionExample">
								<div class="card">
									<div class="card-header" id="headingOne">
										<h2 class="mb-0">
											<button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
												<i class="fas fa-angle-right"></i> Instructions
											</button>
										</h2>
									</div>
									<div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
										<div class="card-body">
											<p>
												1. Pick a route from the dropdown.<br>
												2. This will make the program populate the tables and maps. Scroll down to see your route's onward and return journey laid out in map and tabular form<br>
												3. You can alter a route's sequence by dragging stops in the sequence table up or down by clicking on and holding the handlebars on their left edge. Add more stops to your route with the small selector below each table. <br>
												4. Every time you move stops, the map on the right will update to reflect the new order. Zoom in to the map by using the zoom controls on the map's top left corner.<br>
												5. Clicking on a stop on either map or table will highlight it in both map and table.<br>
												6. There is a Shape menu floating on the map on top right corner. Click on the dropdown to change the shape. If loaded, you will see the shape on the map as a line connecting the stops. See the arrow to know the direction (may need to zoom in a bit to see it clearly).<br>
												7. If you have drawn out the route in a shapefile (having a chain of co-ordinates, called PolyLine), then you can upload it with the "Upload Shapefile" button that appears just below the first (onward) map and above the second (return) map.<br>
												8. If you are designing a new route and have finished laying out the onwards journey by adding stops in sequence, then clicking one of the buttons under "Mirror onward journey" will make an opposite sequence of it in the Return journey table.<br>
												7. Save the Sequence with the big green button at the bottom when done.<br>
											</p>

											<p>
												Note: Changing the default sequence for a route will not change all the trips already existing under this route. The new sequence will reflect only when you create new trips. GTFS standard doesn't store a default stops sequence for a route, so this program is storing it in a separate database file called sequences.json.</p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-12">
							<div class="card">
								<div class="card-header">Select a route:</div>
								<div class="card-body">
									<select id="routeSelect" class="form-control">
										<option></option>
									</select>
								</div>
							</div>
						</div>
					</div>
					<!-- Onward Journey (Direction 0) -->
					<div class="row">
						<div class="col">
							<div class="card">
								<div class="card-header">Onward Journey (Direction 0)</div>
								<div class="card-body">
									<div class="row no-gutters">
										<div class="col">
											<div id="sequence-0-table"></div>
											<div class="row">
												<div class="col-md-10">
													<select id="stopChooser0" class="form-control">
														<option></option>
													</select>
												</div>
												<div class="col-md-2">
													<button class="btn btn-primary" id="add-0" type="button">Add</button>
												</div>
											</div>
										</div>
										<div class="col">
											<div id="map0"></div>
											<div class="shapeOverlay" data-toggle="popover" data-trigger="hover" data-placement="left" data-html="true" title="Shape" data-content="<p>Pick which will be the default shape for this route and direction.<br>&#10004; - Currently saved default shape<br>^ - Just uploaded.<br># - Also being used by some or all trips on this route and direction. (see Schedules section)</p>">
												<h6>Shape</h6>
												<select id="shapes0List" class="form-control col-sm-2">
													<option></option>
												</select>
											</div>
										</div>
									</div>
								</div>
								<div class="card-footer">
									<div class="row">
										<div class="col">
											<p>Mirror onward journey: <button id="flipSequenceReplace" class="btn btn-outline-danger" title="Will turn the return journey (the table below) into a mirror image of the onward journey (the table above)" data-toggle="tooltip" data-placement="top">replace</button>
												/ <button id="flipSequenceInsert" class="btn btn-outline-info" title="will NOT erase present return journey sequence; a mirror image of onward journey will be inserted at the top of the table below." data-toggle="tooltip" data-placement="top">insert</button>
											</p>
										</div>
										<div class="col">
											<button class="btn btn-primary" id="openShapeModal" data-toggle="modal" data-target="#UploadShapeModal" disabled title="Want to set a new shape for this route?">Upload Shapefile</button>
											<button class="btn btn-primary" id="openKMLModal" data-toggle="modal" data-target="#ParseKMLModal" disabled title="Use KML for Journey">Parse KML</button>
											<button class="btn btn-primary" id="openUseRoutingModal" data-toggle="modal" data-target="#OnlineRoutingModal" disabled title="Use online routing services for creating shape file">Online Routing</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<!-- Return Journey (Direction 1) -->
						<div class="col">
							<div class="card">
								<div class="card-header">Return Journey (Direction 1)</div>
								<div class="card-body">
									<div class="row no-gutters">
										<div class="col">
											<div id="sequence-1-table"></div>
											<div class="row">
												<div class="col-10">
													<select id="stopChooser1" class="form-control">
														<option></option>
													</select>
												</div>
												<div class="col-2">
													<button class="btn btn-primary" id="add-1" type="button">Add</button>
												</div>
											</div>
										</div>
										<div class="col">
											<div id="map1"></div>
											<div class="shapeOverlay" data-toggle="popover" data-trigger="hover" data-placement="left" data-html="true" title="Shape" data-content="<p>Pick which will be the default shape for this route and direction.<br><i class='fas fa-save'></i> - Currently saved default shape<br><i class='fas fa-upload'></i> - Just uploaded.<br><i class='fas fa-hashtag'></i> - Also being used by some or all trips on this route and direction. (see Schedules section)</p>">
												<h6>Shape</h6>
												<select id="shapes1List" class="form-control col-sm-2">
													<option></option>
												</select>
											</div>
										</div>

									</div>
								</div>
								<div class="card-footer">
									<div class="row">
										<div class="col-4">
											<button id="saveSequence" class="btn btn-success btn-lg">Save Sequence to DB</button>
										</div>
										<div class="col-8">
											<ul>
												<li>
													Be sure to finalize the sequence of your route and save changes to DB before proceeding to the Schedules section.
												</li>
												<li>
													After saving, please reload the page to see all changes take effect.
												</li>
												<li>Note: Shapes chosen here will be saved for future trips to be created; they will not be assigned to all pre-existing trips under this route. To do that, please visit the Maintenance section.
												</li>
											</ul>
										</div>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- END MAIN CONTENT-->
	<!-- END PAGE CONTAINER-->
	</div>

	</div>

	<!-- Jquery JS-->
	<script src="vendor/jquery-3.2.1.min.js"></script>
	<!-- Bootstrap JS-->
	<script src="vendor/bootstrap-4.1/popper.min.js"></script>
	<script src="vendor/bootstrap-4.1/bootstrap.min.js"></script>

	<!-- Leaflet Maps -->

	<script src="lib/leaflet.js"></script>
	<script src="vendor/leaflet-providers-1.8.0/leaflet-providers.js"></script>
	<script src="lib/leaflet.textpath.js"></script>
	<script src="lib/leaflet-ant-path.js"></script>
	<script src="lib/easy-button.js" alt="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
	<script src="lib/papaparse.min.js" type="text/javascript"></script>
	<script src="lib/L.Control.ZoomBox.min.js" type="text/javascript"></script>
	<script src="vendor/leaflet-control-geocoder-1.8.2/Control.Geocoder.js"></script>
	<script src="vendor/polyline-1.1.0/polyline.js"></script>
	<script src="vendor/togeojson/togeojson.js"></script>

	<!-- Vendor JS       -->

	<script src="vendor/circle-progress/circle-progress.min.js"></script>
	<script src="vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
	<script src="vendor/select2/js/select2.min.js"></script>
	<script src="js/Select2EditorTimezone.js"></script>
	<script src="vendor/toast-0.7.1/toast.min.js"></script>

	<!-- Main JS-->
	<script src="js/main.js"></script>
	<script src="js/menu.js"></script>


	<script src="config/settings.js" type="text/javascript"></script>
	<script src="js/commonfuncs.js" type="text/javascript"></script>
	<script src="js/sequence.js"></script>

	<!-- The Modals -->
	<div class="modal" tabindex="-1" role="dialog" id="UploadShapeModal">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Upload a shape</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-7">
								<b>Onward Journey:</b>
								<div class="form-group row">
									<label for="uploadShape0" class="col-sm-2 col-form-label">Shape File</label>
									<div class="col-sm-10">
										<input type="file" id="uploadShape0" name="uploadShape0" class="form-control" accept=".geojson, .kml, .gpx">
									</div>
								</div>
								<div class="form-group row">
									<label for="uploadShapeId" class="col-sm-2 col-form-label">Shape id prefix</label>
									<div class="col-sm-10">
										<input size=4 id="uploadShapeId" placeholder="shape_id" class="form-control">
									</div>
								</div>
								<b>Return Direction:</b>
								<br><small>This is for cases where the return journey's path diverges from the onward journey.</small>
								<div class="form-group row">
									<label for="reverseCheck" class="col-sm-10 col-form-label">Check ON if you are uploading another shapefile for the route's return journey.</label>
									<div class="col-sm-2">
										<input class="form-check-input" type="checkbox" value="reverseCheck" id="reverseCheck">
									</div>
								</div>
								<div class="form-group row">
									<label for="uploadShape0" class="col-sm-2 col-form-label">Shape File</label>
									<div class="col-sm-10">
										<input type="file" id="uploadShape1" name="uploadShape0" class="form-control" accept=".geojson, .kml, .gpx">
									</div>
								</div>
							</div>
							<div class="col-md-5">
								<p class="alert alert-info">
									Upload a shapefile (.geojson format): <small><a href="xml_related/R001.geojson" target="_blank">see sample</a></small><br />
									Don't have a shapefile in .geojson format? You can convert or create one here: <a href="http://geojson.io" target="_blank">geojson.io</a><br><br>
									Filesupport:<br />
									<ul>
										<li>.geojson</li>
										<li>.kml</li>
										<li>.gpx</li>
									</ul>
									<small>Shape id prefix must be unique, unless you want to overwrite an existing shape. Directions will be added.
										<br>Example: R001: <i>R001_0, R001_1</i>
									</small>
								</p>

							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<p align="center" id="uploadShapeStatus"></p>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					<button id="uploadShapeButton" class="btn btn-primary">Upload >></button>
				</div>
			</div>
		</div>
	</div>
	<!-- End The Modal -->
	<div class="modal" tabindex="-1" role="dialog" id="ParseKMLModal">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Create shape based on stops.</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="form-group row">
						<label for="KMlFile" class="col-sm-2 col-form-label">File:</label>
						<div class="col-sm-10">
							<input type="file" class="form-control-file" id="KMlFile">
						</div>
					</div>
					<div class="form-group row">
						<label for="KMLDirection" class="col-sm-2 col-form-label">Direction:</label>
						<div class="col-sm-10">
							<select id="KMLDirection" class="form-control">
								<option value="sequence0table">Onward Journey (Direction 0)</option>
								<option value="sequence1table">Return Journey (Direction 1)</option>
							</select>
						</div>
					</div>
					Matching will always be done on the kml name attribue and the stop tables stop_name field. 
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary" id="KMLAddSequence">Try to add stops to sequence</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal" tabindex="-1" role="dialog" id="OnlineRoutingModal">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Create shape based on stops in journey.</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">						
						<div class="form-group row">
							<label for="UseService" class="col-sm-6 col-form-label">Use Online routing Service:</label>
							<div class="col-sm-6">
								<select id="RoutingUseService" class="form-control">
									<option value="Mapbox">Mapbox</option>
									<option value="Google">Google</option>
								</select>
							</div>
						</div>
						<div class="form-group row">
								<label for="UseService" class="col-sm-6 col-form-label">shape_id prefix:</label>
								<div class="col-sm-6">
										<input size=4 id="Routingshape_id" placeholder="Routingshape_id" class="form-control">
								</div>
							</div>
						 
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
						<button type="button" class="btn btn-primary" id="OnlineRoute">Try to route!</button>
					</div>
				</div>
			</div>
		</div>
</body>

</html>